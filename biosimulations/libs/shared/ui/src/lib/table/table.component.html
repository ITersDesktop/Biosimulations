<div class="container grid">
  <mat-accordion class="controls">
    <mat-expansion-panel>
      <mat-expansion-panel-header
        [collapsedHeight]="'32px'"
        [expandedHeight]="'32px'"
      >
        <mat-panel-title>
          <biosimulations-icon icon="columns"></biosimulations-icon>
          Columns
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <mat-list>
          <ng-container
            *ngFor="let column of columns"
            #checkboxContainer
          >
            <mat-list-item>
              <mat-checkbox
                #checkbox
                [checked]="column.show !== false"
                (change)="toggleColumn(column)"
                disableRupple
              >
                {{ column.title }}
              </mat-checkbox>
            </mat-list-item>
          </ng-container>
        </mat-list>
      </ng-template>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header
        [collapsedHeight]="'32px'"
        [expandedHeight]="'32px'"
      >
        <mat-panel-title>
          <biosimulations-icon icon="filter"></biosimulations-icon>
          Filters
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <mat-list>
          <ng-container
            *ngFor="let column of columns"
            #checkboxContainer
          >
            <mat-list-item>
              <mat-checkbox
                #checkbox
                [checked]="columnsToShow.includes(column.id)"
                (change)="handleChange(checkbox.checked, column.id)"
              >
                {{ column.title }}
              </mat-checkbox>
            </mat-list-item>
          </ng-container>
        </mat-list>
      </ng-template>
    </mat-expansion-panel>
  </mat-accordion>

  <div class="table-container">
    <mat-table
      matSort
      (matSortChange)="sortRows($event)"
    >
      <ng-container
        [matColumnDef]="column.id"
        *ngFor="let column of columns"
      >
        <mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="column.sortable === false"
          [ngStyle]="{
            'min-width.em': column.minWidth !== undefined ? column.minWidth / 14 : null,
            'justify-content': column.center !== undefined ? 'center' : null
          }"
        >
          {{ column.title }}
        </mat-header-cell>
        <mat-cell *matCellDef="let element"
          [ngStyle]="{
            'min-width.em': column.minWidth !== undefined ? column.minWidth / 14 : null
          }"
        >
          <div [ngSwitch]="column?.container" class="cell-content-container" [ngStyle]="{'text-align': column.center !== undefined ? 'center' : null }">
            <ng-template [ngSwitchCase]="'route'">
              <a *ngIf="getElementRoute(element, column) as route" [routerLink]="route">
                <biosimulations-icon *ngIf="column.icon" [icon]="column.icon" [title]="column.title"></biosimulations-icon>
                {{ formatElementValue(element, column) }}
              </a>
            </ng-template>

            <ng-template [ngSwitchCase]="'href'">
              <a *ngIf="getElementHref(element, column) as href" [href]="href">
                <biosimulations-icon *ngIf="column.icon" [icon]="column.icon" [title]="column.title"></biosimulations-icon>
                {{ formatElementValue(element, column) }}
              </a>
            </ng-template>

            <ng-template ngSwitchDefault>
              <span>
                <biosimulations-icon *ngIf="column.icon" [icon]="column.icon" [title]="column.title"></biosimulations-icon>
                {{ formatElementValue(element, column) }}
              </span>
            </ng-template>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row
        *matHeaderRowDef="columnsToShow; sticky: true"
      ></mat-header-row>
      <mat-row *matRowDef="let row; columns: columnsToShow"
      ></mat-row>
    </mat-table>
  </div>
</div>
